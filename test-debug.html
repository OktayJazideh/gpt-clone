<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Test</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <style>
    body {
      background-color: rgb(33, 33, 33);
      color: white;
      padding: 20px;
    }
    .chat-item {
      background-color: rgb(44, 44, 44);
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      cursor: pointer;
    }
    .chat-item:hover {
      background-color: rgb(55, 55, 55);
    }
    .chat-item:hover .chat-actions {
      opacity: 1 !important;
    }
    .chat-context-menu {
      background: rgb(60, 60, 60);
      border-radius: 8px;
      min-width: 180px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .chat-context-menu .list-group-item {
      background: transparent;
      border: none;
      color: white;
      padding: 8px 12px;
      cursor: pointer;
    }
    .chat-context-menu .list-group-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
  <h2>Debug Test - Chat Actions</h2>
  
  <div class="chat-list">
    <div class="chat-item d-flex align-items-center gap-2 position-relative" data-chat-id="test123">
      <div class="flex-grow-1">تست چت</div>
      <div class="chat-actions" style="opacity: 0; transition: opacity 0.2s;">
        <i class="bi bi-three-dots-vertical" style="cursor: pointer;"></i>
      </div>
      <div class="chat-context-menu" style="display: none; position: absolute; left: 0; top: 100%; z-index: 1000;">
        <div class="list-group list-group-flush">
          <div class="list-group-item chat-action-pin">
            <i class="bi bi-pin"></i>
            <span>پین کردن</span>
          </div>
          <div class="list-group-item chat-action-rename">
            <i class="bi bi-pencil"></i>
            <span>تغییر نام</span>
          </div>
          <div class="list-group-item chat-action-archive">
            <i class="bi bi-archive"></i>
            <span>آرشیو</span>
          </div>
          <div class="list-group-item chat-action-delete">
            <i class="bi bi-trash"></i>
            <span>حذف</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal fade" id="deleteChatModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background-color: rgb(33, 33, 33); color: white;">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-bold">حذف گفت‌وگو</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>آیا مطمئن هستید که می‌خواهید این گفت‌وگو را حذف کنید؟</p>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">لغو</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">حذف</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    $(document).ready(function() {
      console.log('jQuery loaded:', typeof $ !== 'undefined');
      console.log('Bootstrap loaded:', typeof bootstrap !== 'undefined');
      
      // Toggle context menu
      $(document).on('click', '.chat-actions', function(e) {
        e.stopPropagation();
        console.log('Chat actions clicked');
        const menu = $(this).siblings('.chat-context-menu');
        $('.chat-context-menu').not(menu).hide();
        menu.toggle();
      });
      
      // Close menu on outside click
      $(document).on('click', function(e) {
        if (!$(e.target).closest('.chat-actions').length && !$(e.target).closest('.chat-context-menu').length) {
          $('.chat-context-menu').hide();
        }
      });
      
      // Pin action
      $(document).on('click', '.chat-action-pin', function(e) {
        e.stopPropagation();
        console.log('Pin clicked');
        alert('پین شد!');
      });
      
      // Rename action
      $(document).on('click', '.chat-action-rename', function(e) {
        e.stopPropagation();
        console.log('Rename clicked');
        const newName = prompt('نام جدید:', 'تست چت');
        if (newName) {
          alert('نام تغییر کرد به: ' + newName);
        }
      });
      
      // Archive action
      $(document).on('click', '.chat-action-archive', function(e) {
        e.stopPropagation();
        console.log('Archive clicked');
        alert('آرشیو شد!');
      });
      
      // Delete action
      let chatToDelete = null;
      $(document).on('click', '.chat-action-delete', function(e) {
        e.stopPropagation();
        console.log('Delete clicked');
        chatToDelete = $(this).closest('.chat-item').data('chat-id');
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteChatModal'));
        deleteModal.show();
      });
      
      // Confirm delete
      $('#confirmDeleteBtn').on('click', function() {
        console.log('Delete confirmed for:', chatToDelete);
        alert('حذف شد: ' + chatToDelete);
        const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteChatModal'));
        deleteModal.hide();
      });
    });
  </script>
</body>
</html>
