<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø«Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ú†Øª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            padding: 20px;
        }
        .demo-box {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .code-block {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .result-box {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-5">ğŸ§ª Ù…Ø«Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Chat History Manager</h1>

        <!-- Ø§ÛŒØ¬Ø§Ø¯ Ú†Øª Ø¬Ø¯ÛŒØ¯ -->
        <div class="demo-box">
            <h3>1ï¸âƒ£ Ø§ÛŒØ¬Ø§Ø¯ Ú†Øª Ø¬Ø¯ÛŒØ¯</h3>
            <button class="btn btn-primary" id="createChatBtn">Ø§ÛŒØ¬Ø§Ø¯ Ú†Øª Ø¬Ø¯ÛŒØ¯</button>
            <div class="code-block mt-3">
const chat = chatHistoryManager.createChat('Ø³Ù„Ø§Ù…! Ú†Ø·ÙˆØ±ÛŒØŸ');
console.log('Ú†Øª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯:', chat.id);
            </div>
            <div class="result-box" id="createResult"></div>
        </div>

        <!-- Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÛŒØ§Ù… -->
        <div class="demo-box">
            <h3>2ï¸âƒ£ Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ú†Øª</h3>
            <button class="btn btn-success" id="addMessageBtn">Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÛŒØ§Ù…</button>
            <div class="code-block mt-3">
chatHistoryManager.addMessage(chatId, 'Ø§ÛŒÙ† ÛŒÚ© Ù¾ÛŒØ§Ù… ØªØ³ØªÛŒ Ø§Ø³Øª', 'user');
chatHistoryManager.addMessage(chatId, 'Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ', 'assistant');
            </div>
            <div class="result-box" id="addMessageResult"></div>
        </div>

        <!-- Ø¬Ø³ØªØ¬Ùˆ -->
        <div class="demo-box">
            <h3>3ï¸âƒ£ Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ú†Øªâ€ŒÙ‡Ø§</h3>
            <input type="text" class="form-control mb-2" id="searchInput" placeholder="Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
            <button class="btn btn-info" id="searchBtn">Ø¬Ø³ØªØ¬Ùˆ</button>
            <div class="result-box" id="searchResult"></div>
        </div>

        <!-- Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø± -->
        <div class="demo-box">
            <h3>4ï¸âƒ£ Ø¢Ù…Ø§Ø± Ú†Øªâ€ŒÙ‡Ø§</h3>
            <button class="btn btn-warning" id="statsBtn">Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø±</button>
            <div class="result-box" id="statsResult"></div>
        </div>

        <!-- Export/Import -->
        <div class="demo-box">
            <h3>5ï¸âƒ£ Export Ùˆ Import</h3>
            <button class="btn btn-success" id="exportBtn">Export Ø¨Ù‡ JSON</button>
            <button class="btn btn-primary" id="importBtn">Import Ø§Ø² JSON</button>
            <div class="result-box" id="exportImportResult"></div>
        </div>

        <!-- Ù†Ù…Ø§ÛŒØ´ ØªÙ…Ø§Ù… Ú†Øªâ€ŒÙ‡Ø§ -->
        <div class="demo-box">
            <h3>6ï¸âƒ£ Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ú†Øªâ€ŒÙ‡Ø§</h3>
            <button class="btn btn-secondary" id="listChatsBtn">Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª</button>
            <div class="result-box" id="listResult"></div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="chatHistoryManager.js"></script>

    <script>
        let lastCreatedChatId = null;

        // Ø§ÛŒØ¬Ø§Ø¯ Ú†Øª Ø¬Ø¯ÛŒØ¯
        $('#createChatBtn').click(function() {
            const chat = chatHistoryManager.createChat('Ø³Ù„Ø§Ù…! Ø§ÛŒÙ† ÛŒÚ© Ú†Øª ØªØ³ØªÛŒ Ø§Ø³Øª');
            lastCreatedChatId = chat.id;
            $('#createResult').html(`
                <strong>âœ… Ú†Øª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯</strong><br>
                ID: ${chat.id}<br>
                Ø¹Ù†ÙˆØ§Ù†: ${chat.title}<br>
                Ø²Ù…Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯: ${new Date(chat.createdAt).toLocaleString('fa-IR')}
            `);
        });

        // Ø§ÙØ²ÙˆØ¯Ù† Ù¾ÛŒØ§Ù…
        $('#addMessageBtn').click(function() {
            if (!lastCreatedChatId) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ú†Øª Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            chatHistoryManager.addMessage(lastCreatedChatId, 'Ø§ÛŒÙ† ÛŒÚ© Ù¾ÛŒØ§Ù… ØªØ³ØªÛŒ Ø§Ø³Øª', 'user');
            chatHistoryManager.addMessage(lastCreatedChatId, 'Ù…Ù† Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯Ù…!', 'assistant');
            
            const chat = chatHistoryManager.getChatById(lastCreatedChatId);
            $('#addMessageResult').html(`
                <strong>âœ… Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù†Ø¯</strong><br>
                ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§: ${chat.messages.length}<br>
                Ø¢Ø®Ø±ÛŒÙ† Ù¾ÛŒØ§Ù…: ${chat.messages[chat.messages.length - 1].content}
            `);
        });

        // Ø¬Ø³ØªØ¬Ùˆ
        $('#searchBtn').click(function() {
            const query = $('#searchInput').val();
            const results = chatHistoryManager.search(query);
            
            $('#searchResult').html(`
                <strong>ğŸ” Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ</strong><br>
                ØªØ¹Ø¯Ø§Ø¯ Ù†ØªØ§ÛŒØ¬: ${results.length}<br>
                ${results.map(chat => `- ${chat.title} (${chat.messages.length} Ù¾ÛŒØ§Ù…)`).join('<br>')}
            `);
        });

        // Ø¢Ù…Ø§Ø±
        $('#statsBtn').click(function() {
            const stats = chatHistoryManager.getStatistics();
            
            $('#statsResult').html(`
                <strong>ğŸ“Š Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</strong><br>
                Ú©Ù„ Ú†Øªâ€ŒÙ‡Ø§: ${stats.total}<br>
                ÙØ¹Ø§Ù„: ${stats.active}<br>
                Ø¢Ø±Ø´ÛŒÙˆ Ø´Ø¯Ù‡: ${stats.archived}<br>
                Ù¾ÛŒÙ† Ø´Ø¯Ù‡: ${stats.pinned}<br>
                Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§: ${stats.totalMessages}<br>
                Ú©Ù„ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§: ${stats.totalTokens}
            `);
        });

        // Export
        $('#exportBtn').click(function() {
            chatHistoryManager.exportToJSON();
            $('#exportImportResult').html('<strong>âœ… ÙØ§ÛŒÙ„ JSON Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯</strong>');
        });

        // Import
        $('#importBtn').click(function() {
            const input = $('<input type="file" accept=".json">');
            input.on('change', function() {
                const file = this.files[0];
                chatHistoryManager.importFromJSON(file)
                    .then(count => {
                        $('#exportImportResult').html(`<strong>âœ… ${count} Ú†Øª import Ø´Ø¯</strong>`);
                    })
                    .catch(error => {
                        $('#exportImportResult').html(`<strong>âŒ Ø®Ø·Ø§: ${error.message}</strong>`);
                    });
            });
            input.click();
        });

        // Ù„ÛŒØ³Øª Ú†Øªâ€ŒÙ‡Ø§
        $('#listChatsBtn').click(function() {
            const chats = chatHistoryManager.getAll();
            
            if (chats.length === 0) {
                $('#listResult').html('<strong>Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</strong>');
                return;
            }

            const html = chats.map(chat => `
                <div style="border-bottom: 1px solid #ddd; padding: 10px 0;">
                    <strong>${chat.title}</strong><br>
                    Ù…Ø¯Ù„: ${chat.model}<br>
                    Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§: ${chat.messages.length}<br>
                    ${chat.isPinned ? 'ğŸ“Œ Ù¾ÛŒÙ† Ø´Ø¯Ù‡' : ''}
                    ${chat.isArchived ? 'ğŸ“¦ Ø¢Ø±Ø´ÛŒÙˆ Ø´Ø¯Ù‡' : ''}
                </div>
            `).join('');

            $('#listResult').html(html);
        });

        // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡
        console.log('ğŸ“Š Ø¢Ù…Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡:', chatHistoryManager.getStatistics());
    </script>
</body>
</html>
